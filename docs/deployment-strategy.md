# 전체 배포 전략 문서

## 📋 프로젝트 구조 분석

### 현재 아키텍처
- **프론트엔드**: Next.js 15 (React 19)
- **백엔드**: Express.js + WebSocket 서버
- **데이터베이스**: PostgreSQL
- **스토리지**: AWS S3
- **인증**: Google OAuth, Kakao OAuth, JWT
- **주요 기능**: 
  - 업무 관리 (Task Management)
  - 팀 관리
  - 캘린더 (일정 관리)
  - 실시간 채팅 (WebSocket)

---

## 🎯 배포 전략 옵션

### 옵션 1: 하이브리드 배포 (권장) ⭐

#### 구성
- **프론트엔드**: Vercel
- **백엔드**: Railway / Render / EC2
- **데이터베이스**: Supabase / Neon / Railway PostgreSQL
- **스토리지**: AWS S3 (기존 유지)

#### 장점
- ✅ 프론트엔드 배포 간편 (Vercel 자동 배포)
- ✅ 백엔드와 프론트엔드 분리로 독립적 스케일링
- ✅ 비용 효율적 (프론트엔드 무료 티어 활용)
- ✅ CDN 자동 적용 (Vercel)
- ✅ SSL 자동 설정

#### 단점
- ⚠️ CORS 설정 필요
- ⚠️ 환경 변수 관리 복잡도 증가
- ⚠️ 두 플랫폼 관리 필요

#### 예상 비용
- Vercel: 무료 (Hobby) 또는 $20/월 (Pro)
- Railway: $5-20/월
- Render: $7-25/월
- Supabase: 무료 티어 또는 $25/월

#### 추천 이유
- **가장 현실적이고 비용 효율적**
- **프론트엔드와 백엔드 분리로 유지보수 용이**
- **각 서비스의 장점 활용**

---

### 옵션 2: 전체 EC2 배포

#### 구성
- **프론트엔드 + 백엔드**: AWS EC2 (단일 인스턴스)
- **데이터베이스**: RDS PostgreSQL 또는 EC2 내부 PostgreSQL
- **스토리지**: AWS S3 (기존 유지)
- **로드 밸런서**: Application Load Balancer (선택)

#### 장점
- ✅ 모든 것을 한 곳에서 관리
- ✅ 완전한 제어권
- ✅ WebSocket 지원 (문제 없음)
- ✅ 기존 AWS 인프라 활용 가능

#### 단점
- ⚠️ 서버 관리 필요 (보안, 업데이트, 모니터링)
- ⚠️ 초기 설정 복잡
- ⚠️ 비용이 상대적으로 높을 수 있음
- ⚠️ 스케일링 시 수동 작업 필요

#### 예상 비용
- EC2 t3.small: $15-30/월
- RDS db.t3.micro: $15-20/월
- S3: $1-5/월 (사용량에 따라)
- **총: $30-55/월**

#### 추천 이유
- **이미 EC2를 사용 중이라면 통합 관리 용이**
- **완전한 제어가 필요한 경우**

---

### 옵션 3: Docker + 클라우드 플랫폼

#### 구성
- **프론트엔드 + 백엔드**: Docker 컨테이너
- **배포 플랫폼**: Railway / Render / Fly.io
- **데이터베이스**: 플랫폼 제공 PostgreSQL 또는 외부 DB
- **스토리지**: AWS S3

#### 장점
- ✅ 컨테이너화로 일관된 환경
- ✅ 로컬과 프로덕션 환경 일치
- ✅ 배포 자동화 용이
- ✅ 플랫폼 독립적

#### 단점
- ⚠️ Docker 설정 필요
- ⚠️ 초기 구성 복잡
- ⚠️ WebSocket 지원 확인 필요

#### 예상 비용
- Railway: $5-20/월
- Render: $7-25/월
- Fly.io: $5-15/월

---

### 옵션 4: 서버리스 아키텍처 (고급)

#### 구성
- **프론트엔드**: Vercel
- **API**: Vercel Serverless Functions 또는 AWS Lambda
- **WebSocket**: AWS API Gateway WebSocket 또는 Pusher
- **데이터베이스**: Supabase / Neon
- **스토리지**: AWS S3

#### 장점
- ✅ 자동 스케일링
- ✅ 사용량 기반 과금
- ✅ 서버 관리 불필요

#### 단점
- ⚠️ WebSocket 구현 복잡 (서버리스 함수 제한)
- ⚠️ 아키텍처 대폭 수정 필요
- ⚠️ Cold Start 문제 가능
- ⚠️ 비용 예측 어려움

#### 추천 여부
- ❌ **현재 프로젝트에는 비추천** (WebSocket 때문에 복잡도 증가)

---

## 🏆 최종 추천: 옵션 1 (하이브리드 배포)

### 배포 구성도

```
┌─────────────────┐
│   Vercel        │
│  (프론트엔드)    │
│  Next.js        │
└────────┬────────┘
         │ HTTPS
         │ API Calls
         │ WebSocket
         ▼
┌─────────────────┐
│   Railway       │
│  (백엔드)       │
│  Express + WS   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐      ┌──────────────┐
│   Supabase      │      │   AWS S3     │
│  PostgreSQL     │      │  (이미지)    │
└─────────────────┘      └──────────────┘
```

### 단계별 배포 계획

#### Phase 1: 데이터베이스 마이그레이션
1. **Supabase 또는 Neon PostgreSQL 생성**
   - 무료 티어로 시작 가능
   - Prisma 마이그레이션 실행
   - 데이터 백업 및 복원

#### Phase 2: 백엔드 배포
1. **Railway / Render 선택**
   - Railway 추천 (WebSocket 지원 우수)
2. **환경 변수 설정**
   - DATABASE_URL
   - JWT_SECRET
   - AWS 자격 증명
   - OAuth 클라이언트 정보
3. **배포 및 테스트**
   - Health check 확인
   - API 엔드포인트 테스트

#### Phase 3: 프론트엔드 배포
1. **Vercel 프로젝트 생성**
2. **환경 변수 설정**
   - NEXT_PUBLIC_API_URL
   - NEXT_PUBLIC_WS_URL
3. **빌드 및 배포**
4. **CORS 설정 확인**

#### Phase 4: 통합 테스트
1. 인증 플로우 테스트
2. API 통신 테스트
3. WebSocket 연결 테스트
4. 이미지 업로드 테스트

---

## 📝 배포 전 체크리스트

### 필수 준비사항

#### 1. 환경 변수 정리
- [ ] 프로덕션용 환경 변수 목록 작성
- [ ] 민감한 정보 보안 확인
- [ ] OAuth 리다이렉트 URI 업데이트

#### 2. 데이터베이스
- [ ] 프로덕션 DB 생성
- [ ] 마이그레이션 스크립트 준비
- [ ] 백업 전략 수립

#### 3. 코드 수정
- [ ] 환경별 설정 분리
- [ ] CORS 설정
- [ ] 에러 핸들링 강화
- [ ] 로깅 설정

#### 4. 보안
- [ ] HTTPS 강제
- [ ] 환경 변수 암호화
- [ ] API 레이트 리미팅
- [ ] SQL 인젝션 방지 확인

#### 5. 모니터링
- [ ] 에러 추적 도구 설정 (Sentry 등)
- [ ] 로그 수집 설정
- [ ] 성능 모니터링

---

## 💰 비용 비교표

| 옵션 | 월 예상 비용 | 초기 설정 시간 | 유지보수 난이도 |
|------|------------|--------------|---------------|
| 하이브리드 (Vercel + Railway) | $5-25 | 2-3시간 | ⭐⭐ (쉬움) |
| 전체 EC2 | $30-55 | 4-6시간 | ⭐⭐⭐ (보통) |
| Docker + Railway | $5-20 | 3-4시간 | ⭐⭐ (쉬움) |
| 서버리스 | $10-50+ | 8-12시간 | ⭐⭐⭐⭐ (어려움) |

---

## 🚀 다음 단계

1. **배포 옵션 선택** (권장: 옵션 1)
2. **데이터베이스 마이그레이션 가이드 작성**
3. **백엔드 배포 가이드 작성**
4. **프론트엔드 배포 가이드 작성**
5. **환경 변수 설정 가이드 작성**

---

## 📚 참고 자료

- [Vercel 배포 가이드](https://vercel.com/docs)
- [Railway 배포 가이드](https://docs.railway.app)
- [Supabase 가이드](https://supabase.com/docs)
- [Prisma 배포 가이드](https://www.prisma.io/docs/guides/deployment)

---

**작성일**: 2025-01-XX
**버전**: 1.0
